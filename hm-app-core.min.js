!function(){"use strict";angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(a){function d(b,d){function e(a){d.resolve(a)}function f(a){d.reject(a)}c=c||a.get("$http"),c(b).then(e,f)}var c,b=[];return{append:function(a,c){return b.push({config:a,deferred:c})},rejectAll:function(a){if(a)for(var c=0;c<b.length;++c)b[c].deferred.reject(a);b=[]},retryAll:function(a){var c,e;for(console.log(b),c=0;c<b.length;++c)e=a(b[c].config),e!==!1&&d(e,b[c].deferred);b=[]}}}])}(),function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(a,b){return{loginConfirmed:function(c,d){var e=d||function(a){return a};a.$broadcast("event:auth-loginConfirmed",c),b.retryAll(e)},loginCancelled:function(c,d){b.rejectAll(d),a.$broadcast("event:auth-loginCancelled",c)}}}]).config(["$httpProvider",function(a){a.interceptors.push(["$rootScope","$q","httpBuffer",function(a,b,c){return{request:function(a){return void 0!=a.url&&a.url.indexOf("authenticate")>-1&&a.headers&&a.headers.hasOwnProperty("Authorization")&&delete a.headers["Authorization"],a},responseError:function(d){var f,g,e=d.config||{};if(!e.ignoreAuthModule)switch(d.status){case 401:return f=b.defer(),g=c.append(e,f),e.url.indexOf("authenticate")>-1?(console.log("登录接口401 不处理 返回原请求"),b.reject(d)):(1===g&&a.$broadcast("event:auth-loginRequired",d),f.promise);case 403:return f=b.defer(),g=c.append(e,f),1===g&&a.$broadcast("event:auth-forbidden",d),f.promise}return b.reject(d)}}}])}])}(),angular.module("hmAppCore",["ionic","http-auth-interceptor"]).run(function(a){a.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}),null!=HMConfig&&(HMConfig.hasOwnProperty("AUTOREFRSHTOKEN")||(HMConfig.AUTOREFRSHTOKEN=!1),angular.module("hmAppCore").constant("Conf",HMConfig)),angular.module("hmAppCore").factory("Storage",function(){return{set:function(a,b){return window.localStorage.setItem(a,window.JSON.stringify(b))},get:function(a){return window.JSON.parse(window.localStorage.getItem(a))},remove:function(a){return window.localStorage.removeItem(a)},clear:function(){window.localStorage.clear()}}}),angular.module("hmAppCore").factory("HttpAuth",["$rootScope","Storage","authService","$q","$http",function(a,b,c,d,e){function i(){a.$on("event:auth-loginConfirmed",function(){console.log("loginConfirmed")}),a.$on("event:auth-loginRequired",function(){HMConfig.AUTOREFRSHTOKEN&&j().then(function(a){k(a),c.loginConfirmed("success",function(b){return b.headers["Authorization"]=g+a,b})},function(a){console.log(a)})}),a.$on("event:auth-forbidden",function(){j().then(function(a){k(a),c.loginConfirmed("success",function(b){return b.headers["Authorization"]=g+a,b})},function(a){console.log(a)})})}function j(){var a=HMConfig.USERNAME,b=HMConfig.USERPWD,c={username:a,password:b,rememberMe:!0},e=d.defer();return f.post(HMConfig.GATEWAYURL+"api/authenticate",JSON.stringify(c)).success(function(a){a&&a.id_token?e.resolve(a.id_token):a&&e.reject(a)}).error(function(a){e.reject(a)}),e.promise}function k(a){a&&b.set(HMConfig.TOKENID,a)}function l(){return b.get(HMConfig.TOKENID)}var f,g,h;return i(),f={},g="Bearer ",h=function(a){return 2==a.length&&(a={timeout:3e4,headers:{}}),a.timeout=3e4,a.hasOwnProperty("headers")||(a.headers={Authorization:""}),l()&&(a.headers.Authorization=g+l()),a},angular.forEach(["get","delete","head","jsonp"],function(a){f[a]=function(b,c){return c=c||{},c=h(c),e[a](b,c)}}),angular.forEach(["post","put"],function(a){f[a]=function(b,c,d){d=d||{"Content-Type":"application/json"};var f={headers:d};return f=h(f),e[a](b,c,f)}}),f}]),angular.module("hmAppCore").controller("BlankCtrl",["$scope","$ionicHistory",function(a,b){a.goBack=function(){b.goBack()}}]);