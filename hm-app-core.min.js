!function(){"use strict";angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function t(t,r){function o(e){r.resolve(e)}function i(e){r.reject(e)}n=n||e.get("$http"),n(t).then(o,i)}var n,r=[];return{append:function(e,t){return r.push({config:e,deferred:t})},rejectAll:function(e){if(e)for(var t=0;t<r.length;++t)r[t].deferred.reject(e);r=[]},retryAll:function(e){for(var n=0;n<r.length;++n){var o=e(r[n].config);o!==!1&&t(o,r[n].deferred)}r=[]}}}])}(),function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,t){return{loginConfirmed:function(n,r){var o=r||function(e){return e};e.$broadcast("event:auth-loginConfirmed",n),t.retryAll(o)},loginCancelled:function(n,r){t.rejectAll(r),e.$broadcast("event:auth-loginCancelled",n)}}}]).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","httpBuffer",function(e,t,n){return{request:function(e){return void 0!=e.url&&e.url.indexOf("authenticate")>-1&&e.headers&&e.headers.hasOwnProperty("Authorization")&&delete e.headers.Authorization,e},responseError:function(r){var o=r.config||{};if(!o.ignoreAuthModule)switch(r.status){case 401:var i=t.defer(),u=n.append(o,i);return o.url.indexOf("authenticate")>-1?i.promise:(1===u&&e.$broadcast("event:auth-loginRequired",r),i.promise);case 403:var i=t.defer(),u=n.append(o,i);return 1===u&&e.$broadcast("event:auth-forbidden",r),i.promise}return t.reject(r)}}}])}])}(),angular.module("hmAppCore",["ionic","http-auth-interceptor"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),null!=HMConfig&&(HMConfig.hasOwnProperty("AUTOREFRSHTOKEN")||(HMConfig.AUTOREFRSHTOKEN=!1),angular.module("hmAppCore").constant("Conf",HMConfig)),angular.module("hmAppCore").factory("Storage",function(){return{set:function(e,t){return window.localStorage.setItem(e,window.JSON.stringify(t))},get:function(e){return window.JSON.parse(window.localStorage.getItem(e))},remove:function(e){return window.localStorage.removeItem(e)},clear:function(){window.localStorage.clear()}}}),angular.module("hmAppCore").factory("HttpAuth",["$rootScope","Storage","authService","$q","$http",function(e,t,n,r,o){function i(){e.$on("event:auth-loginConfirmed",function(e,t){}),e.$on("event:auth-loginRequired",function(e,t){HMConfig.AUTOREFRSHTOKEN&&u().then(function(e){a(e),n.loginConfirmed("success",function(t){return t.headers.Authorization=d+e,t})},function(e){})}),e.$on("event:auth-forbidden",function(e,t){})}function u(){var e=HMConfig.USERNAME,t=HMConfig.USERPWD,n={username:e,password:t,rememberMe:!0},o=r.defer();return f.post(HMConfig.GATEWAYURL+"api/authenticate",JSON.stringify(n)).success(function(e){e&&e.id_token?o.resolve(e.id_token):e&&o.reject(e)}).error(function(e){o.reject(e)}),o.promise}function a(e){e&&t.set(HMConfig.TOKENID,e)}function c(){return t.get(HMConfig.TOKENID)}i();var f={},d="Bearer ",l=function(e){return 2==e.length&&(e={timeout:3e4,headers:{}}),e.timeout=3e4,e.hasOwnProperty("headers")||(e.headers={Authorization:""}),c()&&(e.headers.Authorization=d+c()),e};return angular.forEach(["get","delete","head","jsonp"],function(e){f[e]=function(t,n){return n=n||{},n=l(n),o[e](t,n)}}),angular.forEach(["post","put"],function(e){f[e]=function(t,n,r){r=r||{"Content-Type":"application/json"};var i={headers:r};return i=l(i),o[e](t,n,i)}}),f}]),angular.module("hmAppCore").controller("BlankCtrl",["$scope","$ionicHistory",function(e,t){e.goBack=function(){t.goBack()}}]);