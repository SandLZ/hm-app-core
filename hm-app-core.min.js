!function(){"use strict";angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(e){function n(n,r){function o(e){r.resolve(e)}function i(e){r.reject(e)}t=t||e.get("$http"),t(n).then(o,i)}var t,r=[];return{append:function(e,n){return r.push({config:e,deferred:n})},rejectAll:function(e){if(e)for(var n=0;n<r.length;++n)r[n].deferred.reject(e);r=[]},retryAll:function(e){for(var t=0;t<r.length;++t){var o=e(r[t].config);o!==!1&&n(o,r[t].deferred)}r=[]}}}])}(),function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(e,n){return{loginConfirmed:function(t,r){var o=r||function(e){return e};e.$broadcast("event:auth-loginConfirmed",t),n.retryAll(o)},loginCancelled:function(t,r){n.rejectAll(r),e.$broadcast("event:auth-loginCancelled",t)}}}]).config(["$httpProvider",function(e){e.interceptors.push(["$rootScope","$q","httpBuffer",function(e,n,t){return{request:function(e){return void 0!=e.url&&e.url.indexOf("authenticate")>-1&&e.headers&&e.headers.hasOwnProperty("Authorization")&&delete e.headers.Authorization,e},responseError:function(r){var o=r.config||{};if(!o.ignoreAuthModule)switch(r.status){case 401:var i=n.defer(),u=t.append(o,i);return o.url.indexOf("authenticate")>-1?i.promise:(1===u&&e.$broadcast("event:auth-loginRequired",r),i.promise);case 403:var i=n.defer(),u=t.append(o,i);return 1===u&&e.$broadcast("event:auth-forbidden",r),i.promise}return n.reject(r)}}}])}])}(),angular.module("hmAppCore",["ionic","http-auth-interceptor"]).run(["$ionicPlatform",function(e){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault()})}]),null!=HMConfig&&(HMConfig.hasOwnProperty("AUTOREFRSHTOKEN")||(HMConfig.AUTOREFRSHTOKEN=!1)),angular.module("hmAppCore").factory("Storage",function(){return{set:function(e,n){return window.localStorage.setItem(e,window.JSON.stringify(n))},get:function(e){return window.JSON.parse(window.localStorage.getItem(e))},remove:function(e){return window.localStorage.removeItem(e)},clear:function(){window.localStorage.clear()}}}),angular.module("hmAppCore").factory("HttpAuth",["$rootScope","Storage","authService","$q","$http",function(e,n,t,r,o){function i(){e.$on("event:auth-loginConfirmed",function(e,n){}),e.$on("event:auth-loginRequired",function(e,n){HMConfig.AUTOREFRSHTOKEN&&u().then(function(e){a(e),t.loginConfirmed("success",function(n){return n.headers.Authorization=d+e,n})},function(e){})}),e.$on("event:auth-forbidden",function(e,n){var r=c();null!=r&&void 0!=r||u().then(function(e){a(e),t.loginConfirmed("success",function(n){return n.headers.Authorization=d+e,n})},function(e){})})}function u(){var e=HMConfig.USERNAME,n=HMConfig.USERPWD,t={username:e,password:n,rememberMe:!0},o=r.defer();return f.post(HMConfig.GATEWAYURL+"api/authenticate",JSON.stringify(t)).success(function(e){e&&e.id_token?o.resolve(e.id_token):e&&o.reject(e)}).error(function(e){o.reject(e)}),o.promise}function a(e){e&&n.set(HMConfig.TOKENID,e)}function c(){return n.get(HMConfig.TOKENID)}i();var f={},d="Bearer ",l=function(e){return 2==e.length&&(e={timeout:3e4,headers:{}}),e.timeout=3e4,e.hasOwnProperty("headers")||(e.headers={Authorization:""}),c()&&(e.headers.Authorization=d+c()),e};return angular.forEach(["get","delete","head","jsonp"],function(e){f[e]=function(n,t){return t=t||{},t=l(t),o[e](n,t)}}),angular.forEach(["post","put"],function(e){f[e]=function(n,t,r){r=r||{"Content-Type":"application/json"};var i={headers:r};return i=l(i),o[e](n,t,i)}}),f}]),angular.module("hmAppCore").controller("BlankCtrl",["$scope","$ionicHistory",function(e,n){e.goBack=function(){n.goBack()}}]);